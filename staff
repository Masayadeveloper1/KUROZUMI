<!-- ä»¥ä¸‹ã¯ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã¨åŒä¸€ãƒšãƒ¼ã‚¸å†… -->
<!-- Staff.htmlï¼ˆçœç•¥éƒ¨åˆ†ã¯å‰ãƒ•ã‚§ãƒ¼ã‚ºã®å†…å®¹ã¨åŒæ§˜ï¼‰ -->
...
  <div id="result" class="result"></div>

  <hr style="margin: 40px 0;">

  <h2>ğŸ“‹ ç™»éŒ²æ¸ˆã¿ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§</h2>
  <table id="staffTable">
    <thead>
      <tr>
        <th>æ°å</th>
        <th>æ‰€å±</th>
        <th>å½¹è·</th>
        <th>é›»è©±ç•ªå·</th>
        <th>ãƒ¡ãƒ¼ãƒ«</th>
        <th>å…¥ç¤¾æ—¥</th>
        <th>ãƒ¡ãƒ¢</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†ï¼ˆå‰ãƒ•ã‚§ãƒ¼ã‚ºã¨åŒã˜ï¼‰
    const form = document.getElementById('staffForm');
    const result = document.getElementById('result');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());

      google.script.run
        .withSuccessHandler(() => {
          result.innerHTML = `<span style="color: green;">âœ… ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ</span>`;
          form.reset();
          loadStaffList(); // å†èª­ã¿è¾¼ã¿
        })
        .withFailureHandler(err => {
          result.innerHTML = `<span style="color: red;">âŒ ã‚¨ãƒ©ãƒ¼: ${err.message}</span>`;
        })
        .submitStaffForm(data);
    });

    // ä¸€è¦§è¡¨ç¤ºå‡¦ç†
    function loadStaffList() {
      google.script.run.withSuccessHandler(renderStaffTable).getStaffList();
    }

    function renderStaffTable(data) {
      const tbody = document.querySelector("#staffTable tbody");
      tbody.innerHTML = '';

      data.forEach((row, index) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });

        // å‰Šé™¤ãƒœã‚¿ãƒ³è¿½åŠ 
        const td = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = 'ğŸ—‘ï¸ å‰Šé™¤';
        btn.onclick = () => {
          if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
            google.script.run
              .withSuccessHandler(() => loadStaffList())
              .deleteStaffByIndex(index + 2); // ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒã‚ã‚‹ãŸã‚+2
          }
        };
        btn.className = 'danger';
        td.appendChild(btn);
        tr.appendChild(td);

        tbody.appendChild(tr);
      });
    }

    // åˆå›èª­ã¿è¾¼ã¿
    window.onload = () => {
      loadStaffList();
    };
  </script>
</body>
</html>
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  font-size: 14px;
}

th, td {
  padding: 10px;
  border: 1px solid #d1d5db;
  text-align: left;
}

th {
  background-color: #f3f4f6;
}

button.danger {
  background: #ef4444;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}

button.danger:hover {
  background: #dc2626;
}
<hr style="margin: 40px 0;">

<h2>ğŸ§  å…¥åŠ›ã‚µãƒãƒ¼ãƒˆï¼ˆGPTã«è³ªå•ï¼‰</h2>
<p>ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ä¸‹è¨˜ã«å…¥åŠ›ã—ã¦ GPT ã«è³ªå•ã—ã¦ãã ã•ã„ã€‚</p>

<div class="gpt-assist">
  <input type="text" id="gpt-question" placeholder="ä¾‹ï¼šå½¹è·ã£ã¦ä½•ã‚’å…¥åŠ›ã™ã‚Œã°ã„ã„ï¼Ÿ">
  <button onclick="askGPT()">è³ªå•ã™ã‚‹</button>
</div>

<div id="gpt-answer" class="gpt-answer">ğŸ’¬ å›ç­”ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>

<script>
  function askGPT() {
    const question = document.getElementById('gpt-question').value;
    const answerBox = document.getElementById('gpt-answer');

    if (!question.trim()) {
      answerBox.innerHTML = "â— è³ªå•å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„";
      return;
    }

    answerBox.innerHTML = "â³ å›ç­”ã‚’ç”Ÿæˆä¸­ã§ã™...";

    google.script.run
      .withSuccessHandler(res => {
        answerBox.innerHTML = "ğŸ’¬ " + res;
      })
      .withFailureHandler(err => {
        answerBox.innerHTML = "âŒ ã‚¨ãƒ©ãƒ¼: " + err.message;
      })
      .askGPT(question);
  }
</script>
.gpt-assist {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.gpt-assist input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
}

.gpt-assist button {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
}

.gpt-assist button:hover {
  background: #2563eb;
}

.gpt-answer {
  background: #f3f4f6;
  border-radius: 8px;
  padding: 12px;
  margin-top: 16px;
  font-size: 14px;
  white-space: pre-wrap;
}
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <title>ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</title>
  <?!= include('style.html') ?>
  <?!= include('components/formBuilder.html') ?>
  <?!= include('components/tableBuilder.html') ?>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘¥ ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†</h1>

    <div id="form-area"></div>
    <hr>
    <h2>ğŸ“‹ ä¸€è¦§</h2>
    <div id="table-area"></div>
  </div>

  <script>
    const CURRENT_SHEET = "MST_Staff";

    const formConfig = [
      { name: "name", label: "æ°å", tooltip: "ã‚¹ã‚¿ãƒƒãƒ•ã®æ°å", required: true },
      { name: "department", label: "æ‰€å±", tooltip: "åº—èˆ—ã‚„éƒ¨ç½²å" },
      { name: "position", label: "å½¹è·", tooltip: "æ‹…å½“ã®å½¹è·" },
      { name: "phone", label: "é›»è©±ç•ªå·", tooltip: "é€£çµ¡å…ˆï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰" },
      { name: "email", label: "ãƒ¡ãƒ¼ãƒ«", tooltip: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", type: "email" },
      { name: "startDate", label: "å…¥ç¤¾æ—¥", tooltip: "å‹¤å‹™é–‹å§‹æ—¥", type: "date" },
      { name: "note", label: "ãƒ¡ãƒ¢", tooltip: "ç‰¹è¨˜äº‹é …", type: "textarea" }
    ];

    function render() {
      // ãƒ•ã‚©ãƒ¼ãƒ æç”»
      const form = buildForm(formConfig, "render");
      document.getElementById("form-area").innerHTML = "";
      document.getElementById("form-area").appendChild(form);

      // ä¸€è¦§è¡¨ç¤º
      google.script.run.withSuccessHandler(data => {
        const table = buildTable(
          formConfig.map(f => f.label),
          data,
          "render"
        );
        const area = document.getElementById("table-area");
        area.innerHTML = "";
        area.appendChild(table);
      }).getGenericData(CURRENT_SHEET);
    }

    window.onload = render;
  </script>
</body>
</html>
<?!= include('gpt-helper.html') ?>
<script>
  function handleError(error) {
    const context = "[Client]";
    const msg = error && error.message ? error.message : "âŒ æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
    console.error(`${context} âŒ ${msg}`);
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + msg);
  }
</script>
google.script.run
  .withFailureHandler(handleError)
  .submitGenericForm(data, "MST_Staff");
