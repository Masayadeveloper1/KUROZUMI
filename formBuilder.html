<!-- æ±ç”¨ãƒ•ã‚©ãƒ¼ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
<script>
  function buildForm(config, onSubmitCallbackName) {
    const form = document.createElement("form");
    form.id = "dynamicForm";

    config.forEach(field => {
      const div = document.createElement("div");
      div.className = "form-group";

      const label = document.createElement("label");
      label.innerHTML = `${field.label} <span class="tooltip" title="${field.tooltip}">ğŸ›ˆ</span>`;
      div.appendChild(label);

      let input;
      if (field.type === "textarea") {
        input = document.createElement("textarea");
        input.rows = 3;
      } else {
        input = document.createElement("input");
        input.type = field.type || "text";
      }
      input.name = field.name;
      input.required = !!field.required;
      div.appendChild(input);
      form.appendChild(div);
    });

    const submit = document.createElement("button");
    submit.type = "submit";
    submit.textContent = "ğŸ“¤ ç™»éŒ²ã™ã‚‹";
    form.appendChild(submit);

    form.onsubmit = function (e) {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      google.script.run
        .withSuccessHandler(() => {
          alert("âœ… ç™»éŒ²å®Œäº†");
          form.reset();
          window[onSubmitCallbackName]?.(); // å†èª­ã¿è¾¼ã¿ãªã©
        })
        .withFailureHandler(err => alert("âŒ ã‚¨ãƒ©ãƒ¼: " + err.message))
        .submitGenericForm(data, CURRENT_SHEET);
    };

    return form;
  }
</script>
// è¿½åŠ ï¼šã‚»ãƒ¬ã‚¯ãƒˆ or ãƒ†ã‚­ã‚¹ãƒˆ or ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å‡¦ç†
if (field.type === "select") {
  input = document.createElement("select");
  (field.options || []).forEach(opt => {
    const option = document.createElement("option");
    option.value = opt;
    option.textContent = opt;
    input.appendChild(option);
  });
} else if (field.type === "textarea") {
  input = document.createElement("textarea");
  input.rows = 3;
} else {
  input = document.createElement("input");
  input.type = field.type || "text";
}
if (field.readonly) {
  input.readOnly = true;
  input.style.backgroundColor = "#f9fafb";
}
<?!= include('gpt-helper.html') ?>
<script>
  function handleError(error) {
    const context = "[Client]";
    const msg = error && error.message ? error.message : "âŒ æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
    console.error(`${context} âŒ ${msg}`);
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + msg);
  }
</script>
google.script.run
  .withFailureHandler(handleError)
  .submitGenericForm(data, "MST_Staff");
