<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <title>é¡§å®¢ç®¡ç†</title>
  <?!= include('style.html') ?>
  <?!= include('components/formBuilder.html') ?>
  <?!= include('components/tableBuilder.html') ?>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘¤ é¡§å®¢ç®¡ç†</h1>

    <div id="form-area"></div>
    <hr>
    <h2>ğŸ“‹ ä¸€è¦§</h2>
    <div id="table-area"></div>
  </div>

  <script>
    const CURRENT_SHEET = "MST_Customer";

    const formConfig = [
      { name: "name", label: "æ°å", tooltip: "é¡§å®¢ã®ãƒ•ãƒ«ãƒãƒ¼ãƒ ã‚’å…¥åŠ›", required: true },
      { name: "phone", label: "é›»è©±ç•ªå·", tooltip: "é¡§å®¢ã®é›»è©±ç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ï¼‰" },
      { name: "email", label: "ãƒ¡ãƒ¼ãƒ«", tooltip: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" },
      { name: "lastVisit", label: "æ¥åº—æ—¥", tooltip: "æœ€å¾Œã®æ¥åº—æ—¥ï¼ˆä¾‹ï¼š2024-09-20ï¼‰", type: "date" },
      { name: "note", label: "ãƒ¡ãƒ¢", tooltip: "å‚™è€ƒã‚„æ¥å®¢ãƒ¡ãƒ¢ãªã©" }
    ];

    function render() {
      const form = buildForm(formConfig, "render");
      document.getElementById("form-area").innerHTML = "";
      document.getElementById("form-area").appendChild(form);

      google.script.run.withSuccessHandler(data => {
        const table = buildTable(
          formConfig.map(f => f.label),
          data,
          "render"
        );
        const area = document.getElementById("table-area");
        area.innerHTML = "";
        area.appendChild(table);
      }).getGenericData(CURRENT_SHEET);
    }

    window.onload = render;
  </script>
</body>
</html>
<?!= include('gpt-helper.html') ?>
<script>
  function handleError(error) {
    const context = "[Client]";
    const msg = error && error.message ? error.message : "âŒ æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
    console.error(`${context} âŒ ${msg}`);
    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n" + msg);
  }
</script>
google.script.run
  .withFailureHandler(handleError)
  .submitGenericForm(data, "MST_Staff");
